import{l as S,p as _,f as V,c,a as l,q as a,x as r,h as s,s as b,G as h,d as U,F as P,r as C,t as x,m as z,o as f,i as M}from"./Bd8ljqR2.js";import{u as O}from"./BOh-c-DE.js";import{_ as N}from"./DlAUqK2U.js";const B={class:"max-w-3xl mx-auto p-6 bg-slate-50/75"},F={class:"grid grid-cols-2 gap-4"},I={class:"grid grid-cols-3 gap-4"},$={class:"justify-center flex"},T=["disabled"],j={key:0},A={key:1},D={class:"flex justify-between items-center"},E={class:"font-semibold"},L={class:"font-bold"},R=["onUpdate:modelValue"],Y={class:"text-right text-lg font-semibold"},G={__name:"plaseaza-comanda",setup(H){const q=O();let n="",d="",y="cod",o={street1:"",city:"",state:"",zip:""},u="",p="";const m=S(!1),v=S([]);_(()=>{const i=localStorage.getItem("cart");if(console.log("Stored items:",i),i)try{v.value=JSON.parse(i)}catch(e){console.error("Failed to parse cartItems from localStorage",e)}});const g=V(()=>v.value.reduce((i,e)=>i+e.price*e.quantity,0)),k=async()=>{var e;if(m.value)return;m.value=!0;const i={customer_name:`${n} ${d}`,customer_address:`${o.street1} ${o.city} ${o.state}, ${o.zip}`,customer_email:u,customer_phone:p,products:v.value.filter(t=>t.quantity>0).map(t=>({quantity:t.quantity,product_id:t.id,name:t.name,unit_price:t.price})),total_price:g.value,status:"pending"};console.log("Payload:",i);try{const t=M(),w=await $fetch(`${t.public.apiBase}/orders`,{method:"POST",body:i});q.clear(),window.location.href="/",alert("Order submitted successfully!")}catch(t){console.error("Order submission error:",t),(e=t.response)!=null&&e._data?(console.error("Server said:",t.response._data),alert(t.response._data.message),window.location.href="/"):alert("Failed to submit order.")}finally{m.value=!1}};return(i,e)=>(f(),c("div",B,[e[17]||(e[17]=l("h1",{class:"text-3xl font-bold mb-6"},"Purchase Order",-1)),l("form",{onSubmit:z(k,["prevent"]),class:"space-y-6"},[e[16]||(e[16]=l("div",null,[l("label",{class:"block mb-2 font-semibold"},"What would you like to purchase?")],-1)),l("div",F,[a(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>b(n)?n.value=t:n=t),type:"text",placeholder:"First Name",class:"input",required:""},null,512),[[r,s(n)]]),a(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>b(d)?d.value=t:d=t),type:"text",placeholder:"Last Name",class:"input",required:""},null,512),[[r,s(d)]])]),l("div",null,[e[9]||(e[9]=l("label",{class:"block mb-1 font-semibold"},"Your E-mail",-1)),a(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>b(u)?u.value=t:u=t),type:"email",placeholder:"example@example.com",class:"input w-full",required:""},null,512),[[r,s(u)]])]),l("div",null,[e[10]||(e[10]=l("label",{class:"block mb-1 font-semibold"},"Your Phone number",-1)),a(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>b(p)?p.value=t:p=t),type:"text",placeholder:"",class:"input w-full",required:""},null,512),[[r,s(p)]])]),l("div",null,[e[11]||(e[11]=l("label",{class:"block mb-1 font-semibold"},"Shipping Address",-1)),a(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s(o).street1=t),type:"text",placeholder:"Street Address",class:"input w-full mb-2",required:""},null,512),[[r,s(o).street1]]),l("div",I,[a(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>s(o).city=t),type:"text",placeholder:"City",class:"input",required:""},null,512),[[r,s(o).city]]),a(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>s(o).state=t),type:"text",placeholder:"State / Province",class:"input",required:""},null,512),[[r,s(o).state]]),a(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>s(o).zip=t),type:"text",placeholder:"Postal / Zip Code",class:"input",required:""},null,512),[[r,s(o).zip]])])]),l("div",null,[e[13]||(e[13]=l("label",{class:"block mb-2 font-semibold"},"Payment Methods",-1)),a(l("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>b(y)?y.value=t:y=t),class:"input w-full"},e[12]||(e[12]=[l("option",{value:"cod"},"Numerar la livrare",-1),l("option",{disabled:"",value:"card"},"Card - indisponibil momentan",-1)]),512),[[h,s(y)]])]),l("div",$,[l("button",{type:"submit",disabled:s(m),class:"bg-blue-600 text-white py-2 px-6 rounded hover:bg-blue-700"},[s(m)?(f(),c("span",j,e[14]||(e[14]=[l("svg",{class:"animate-spin h-5 w-5 mr-2 inline-block text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),U(" Se trimite... ")]))):(f(),c("span",A," Submit Order "))],8,T)]),l("div",null,[e[15]||(e[15]=l("h2",{class:"text-xl font-semibold mb-4"},"My Products",-1)),(f(!0),c(P,null,C(s(v),t=>(f(),c("div",{key:t.name,class:"border p-4 rounded mb-4"},[l("div",D,[l("div",null,[l("p",E,x(t.name),1)]),l("div",null,[l("span",L,"$"+x(t.price),1),a(l("input",{type:"number",min:"0",class:"input ml-4 w-20","onUpdate:modelValue":w=>t.quantity=w},null,8,R),[[r,t.quantity,void 0,{number:!0}]])])])]))),128))]),l("div",Y," Total: $"+x(s(g)),1)],32)]))}},K=N(G,[["__scopeId","data-v-07479abe"]]);export{K as default};
